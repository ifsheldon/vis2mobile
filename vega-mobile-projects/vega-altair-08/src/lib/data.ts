export interface RawDatum {
  yield: number;
  variety: string;
  year: number;
  site: string;
}

export const rawData: RawDatum[] = [
  { yield: 27, variety: "Manchuria", year: 1931, site: "University Farm" },
  { yield: 48.86667, variety: "Manchuria", year: 1931, site: "Waseca" },
  { yield: 27.43334, variety: "Manchuria", year: 1931, site: "Morris" },
  { yield: 39.93333, variety: "Manchuria", year: 1931, site: "Crookston" },
  { yield: 32.96667, variety: "Manchuria", year: 1931, site: "Grand Rapids" },
  { yield: 28.96667, variety: "Manchuria", year: 1931, site: "Duluth" },
  { yield: 43.06666, variety: "Glabron", year: 1931, site: "University Farm" },
  { yield: 55.2, variety: "Glabron", year: 1931, site: "Waseca" },
  { yield: 28.76667, variety: "Glabron", year: 1931, site: "Morris" },
  { yield: 38.13333, variety: "Glabron", year: 1931, site: "Crookston" },
  { yield: 29.13333, variety: "Glabron", year: 1931, site: "Grand Rapids" },
  { yield: 29.66667, variety: "Glabron", year: 1931, site: "Duluth" },
  { yield: 35.13333, variety: "Svansota", year: 1931, site: "University Farm" },
  { yield: 47.33333, variety: "Svansota", year: 1931, site: "Waseca" },
  { yield: 25.76667, variety: "Svansota", year: 1931, site: "Morris" },
  { yield: 40.46667, variety: "Svansota", year: 1931, site: "Crookston" },
  { yield: 29.66667, variety: "Svansota", year: 1931, site: "Grand Rapids" },
  { yield: 25.7, variety: "Svansota", year: 1931, site: "Duluth" },
  { yield: 39.9, variety: "Velvet", year: 1931, site: "University Farm" },
  { yield: 50.23333, variety: "Velvet", year: 1931, site: "Waseca" },
  { yield: 26.13333, variety: "Velvet", year: 1931, site: "Morris" },
  { yield: 41.33333, variety: "Velvet", year: 1931, site: "Crookston" },
  { yield: 23.03333, variety: "Velvet", year: 1931, site: "Grand Rapids" },
  { yield: 26.3, variety: "Velvet", year: 1931, site: "Duluth" },
  { yield: 36.56666, variety: "Trebi", year: 1931, site: "University Farm" },
  { yield: 63.8333, variety: "Trebi", year: 1931, site: "Waseca" },
  { yield: 43.76667, variety: "Trebi", year: 1931, site: "Morris" },
  { yield: 46.93333, variety: "Trebi", year: 1931, site: "Crookston" },
  { yield: 29.76667, variety: "Trebi", year: 1931, site: "Grand Rapids" },
  { yield: 33.93333, variety: "Trebi", year: 1931, site: "Duluth" },
  { yield: 32.73333, variety: "No. 457", year: 1931, site: "University Farm" },
  { yield: 48.16667, variety: "No. 457", year: 1931, site: "Waseca" },
  { yield: 28.23333, variety: "No. 457", year: 1931, site: "Morris" },
  { yield: 40.23333, variety: "No. 457", year: 1931, site: "Crookston" },
  { yield: 26.2, variety: "No. 457", year: 1931, site: "Grand Rapids" },
  { yield: 30.46667, variety: "No. 457", year: 1931, site: "Duluth" },
  { yield: 31.36667, variety: "No. 462", year: 1931, site: "University Farm" },
  { yield: 48.56667, variety: "No. 462", year: 1931, site: "Waseca" },
  { yield: 25.23333, variety: "No. 462", year: 1931, site: "Morris" },
  { yield: 44.8, variety: "No. 462", year: 1931, site: "Crookston" },
  { yield: 25.33333, variety: "No. 462", year: 1931, site: "Grand Rapids" },
  { yield: 30.6, variety: "No. 462", year: 1931, site: "Duluth" },
  { yield: 32.6, variety: "Peatland", year: 1931, site: "University Farm" },
  { yield: 52.6, variety: "Peatland", year: 1931, site: "Waseca" },
  { yield: 23.33333, variety: "Peatland", year: 1931, site: "Morris" },
  { yield: 41.36667, variety: "Peatland", year: 1931, site: "Crookston" },
  { yield: 31.36667, variety: "Peatland", year: 1931, site: "Grand Rapids" },
  { yield: 32.3, variety: "Peatland", year: 1931, site: "Duluth" },
  { yield: 39.3, variety: "No. 475", year: 1931, site: "University Farm" },
  { yield: 44.23333, variety: "No. 475", year: 1931, site: "Waseca" },
  { yield: 26.33333, variety: "No. 475", year: 1931, site: "Morris" },
  { yield: 44.1, variety: "No. 475", year: 1931, site: "Crookston" },
  { yield: 27.36667, variety: "No. 475", year: 1931, site: "Grand Rapids" },
  { yield: 29.33333, variety: "No. 475", year: 1931, site: "Duluth" },
  {
    yield: 26.96667,
    variety: "Wisconsin No. 38",
    year: 1931,
    site: "University Farm",
  },
  { yield: 58.1, variety: "Wisconsin No. 38", year: 1931, site: "Waseca" },
  { yield: 25.46667, variety: "Wisconsin No. 38", year: 1931, site: "Morris" },
  {
    yield: 46.86667,
    variety: "Wisconsin No. 38",
    year: 1931,
    site: "Crookston",
  },
  {
    yield: 29.66667,
    variety: "Wisconsin No. 38",
    year: 1931,
    site: "Grand Rapids",
  },
  { yield: 25.73333, variety: "Wisconsin No. 38", year: 1931, site: "Duluth" },
  { yield: 26.9, variety: "Manchuria", year: 1932, site: "University Farm" },
  { yield: 33.46667, variety: "Manchuria", year: 1932, site: "Waseca" },
  { yield: 34.36666, variety: "Manchuria", year: 1932, site: "Morris" },
  { yield: 32.96667, variety: "Manchuria", year: 1932, site: "Crookston" },
  { yield: 22.13333, variety: "Manchuria", year: 1932, site: "Grand Rapids" },
  { yield: 22.56667, variety: "Manchuria", year: 1932, site: "Duluth" },
  { yield: 36.8, variety: "Glabron", year: 1932, site: "University Farm" },
  { yield: 37.73333, variety: "Glabron", year: 1932, site: "Waseca" },
  { yield: 35.13333, variety: "Glabron", year: 1932, site: "Morris" },
  { yield: 26.16667, variety: "Glabron", year: 1932, site: "Crookston" },
  { yield: 14.43333, variety: "Glabron", year: 1932, site: "Grand Rapids" },
  { yield: 25.86667, variety: "Glabron", year: 1932, site: "Duluth" },
  { yield: 27.43334, variety: "Svansota", year: 1932, site: "University Farm" },
  { yield: 38.5, variety: "Svansota", year: 1932, site: "Waseca" },
  { yield: 35.03333, variety: "Svansota", year: 1932, site: "Morris" },
  { yield: 20.63333, variety: "Svansota", year: 1932, site: "Crookston" },
  { yield: 16.63333, variety: "Svansota", year: 1932, site: "Grand Rapids" },
  { yield: 22.23333, variety: "Svansota", year: 1932, site: "Duluth" },
  { yield: 26.8, variety: "Velvet", year: 1932, site: "University Farm" },
  { yield: 37.4, variety: "Velvet", year: 1932, site: "Waseca" },
  { yield: 38.83333, variety: "Velvet", year: 1932, site: "Morris" },
  { yield: 32.03333, variety: "Velvet", year: 1932, site: "Crookston" },
  { yield: 19.46667, variety: "Velvet", year: 1932, site: "Grand Rapids" },
  { yield: 22.46667, variety: "Velvet", year: 1932, site: "Duluth" },
  { yield: 29.06667, variety: "Trebi", year: 1932, site: "University Farm" },
  { yield: 49.2333, variety: "Trebi", year: 1932, site: "Waseca" },
  { yield: 46.63333, variety: "Trebi", year: 1932, site: "Morris" },
  { yield: 41.83333, variety: "Trebi", year: 1932, site: "Crookston" },
  { yield: 20.63333, variety: "Trebi", year: 1932, site: "Grand Rapids" },
  { yield: 30.6, variety: "Trebi", year: 1932, site: "Duluth" },
  { yield: 21.43333, variety: "No. 457", year: 1932, site: "University Farm" },
  { yield: 44.43333, variety: "No. 457", year: 1932, site: "Waseca" },
  { yield: 41.6, variety: "No. 457", year: 1932, site: "Morris" },
  { yield: 29.53333, variety: "No. 457", year: 1932, site: "Crookston" },
  { yield: 13.5, variety: "No. 457", year: 1932, site: "Grand Rapids" },
  { yield: 22.66667, variety: "No. 457", year: 1932, site: "Duluth" },
  { yield: 21, variety: "No. 462", year: 1932, site: "University Farm" },
  { yield: 43.53333, variety: "No. 462", year: 1932, site: "Waseca" },
  { yield: 39.7, variety: "No. 462", year: 1932, site: "Morris" },
  { yield: 32.66667, variety: "No. 462", year: 1932, site: "Crookston" },
  { yield: 19.46667, variety: "No. 462", year: 1932, site: "Grand Rapids" },
  { yield: 22.5, variety: "No. 462", year: 1932, site: "Duluth" },
  { yield: 25.23333, variety: "Peatland", year: 1932, site: "University Farm" },
  { yield: 33.5, variety: "Peatland", year: 1932, site: "Waseca" },
  { yield: 39.1, variety: "Peatland", year: 1932, site: "Morris" },
  { yield: 36.9, variety: "Peatland", year: 1932, site: "Crookston" },
  { yield: 17, variety: "Peatland", year: 1932, site: "Grand Rapids" },
  { yield: 26.76667, variety: "Peatland", year: 1932, site: "Duluth" },
  { yield: 30.6, variety: "No. 475", year: 1932, site: "University Farm" },
  { yield: 33.33333, variety: "No. 475", year: 1932, site: "Waseca" },
  { yield: 33.9, variety: "No. 475", year: 1932, site: "Morris" },
  { yield: 30.43333, variety: "No. 475", year: 1932, site: "Crookston" },
  { yield: 15.43333, variety: "No. 475", year: 1932, site: "Grand Rapids" },
  { yield: 27.36667, variety: "No. 475", year: 1932, site: "Duluth" },
  {
    yield: 21.36667,
    variety: "Wisconsin No. 38",
    year: 1932,
    site: "University Farm",
  },
  { yield: 47.33333, variety: "Wisconsin No. 38", year: 1932, site: "Waseca" },
  { yield: 38.16667, variety: "Wisconsin No. 38", year: 1932, site: "Morris" },
  {
    yield: 35.13333,
    variety: "Wisconsin No. 38",
    year: 1932,
    site: "Crookston",
  },
  {
    yield: 15.9,
    variety: "Wisconsin No. 38",
    year: 1932,
    site: "Grand Rapids",
  },
  { yield: 29.33333, variety: "Wisconsin No. 38", year: 1932, site: "Duluth" },
];

export interface ProcessedVariety {
  name: string;
  total: number;
  sites: { [siteName: string]: number };
}

export function processData(): { data: ProcessedVariety[]; sites: string[] } {
  const varietiesMap: { [name: string]: ProcessedVariety } = {};
  const sitesSet = new Set<string>();

  rawData.forEach((d) => {
    if (!varietiesMap[d.variety]) {
      varietiesMap[d.variety] = { name: d.variety, total: 0, sites: {} };
    }
    if (!varietiesMap[d.variety].sites[d.site]) {
      varietiesMap[d.variety].sites[d.site] = 0;
    }
    varietiesMap[d.variety].sites[d.site] += d.yield;
    varietiesMap[d.variety].total += d.yield;
    sitesSet.add(d.site);
  });

  const data = Object.values(varietiesMap).sort((a, b) => b.total - a.total);
  return { data, sites: Array.from(sitesSet) };
}
