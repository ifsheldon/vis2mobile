<!DOCTYPE html>
<html>
<head>
  <title>28.html</title>
  <meta charset="utf-8" />
  <script src="../assets/vega.min.js"></script>
  <script src="../assets/vega-lite.min.js"></script>
  <script src="../assets/vega-embed.min.js"></script>
  <style>
    body { margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
    #vis { width: 95%; max-width: 800px; }
  </style>
</head>
<body>
  <div id="vis"></div>
  <script type="text/javascript">
    var spec = {"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "axis": {"labelFontSize": 12, "titleFontSize": 12}}, "layer": [{"mark": {"type": "circle", "size": 100}, "encoding": {"color": {"field": "region", "legend": {"labelFontSize": 12, "orient": "bottom-left", "titleFontSize": 14}, "scale": {"scheme": "dark2"}, "title": "Region", "type": "nominal"}, "detail": {"field": "country", "type": "nominal"}, "opacity": {"condition": [{"test": {"and": [{"param": "param_0f5c0e4c9fd46f03"}, "test(regexp(param_82df1923d868131d,'i'),datum.country)"]}, "value": 0.8}], "value": 0.1}, "x": {"field": "fertility", "scale": {"zero": false}, "title": "Babies per woman (total fertility rate)", "type": "quantitative"}, "y": {"field": "life_expect", "scale": {"zero": false}, "title": "Life expectancy", "type": "quantitative"}}, "name": "view_8564c15f60459f85_0", "transform": [{"calculate": "{\n        '0': 'South Asia',\n        '1': 'Europe & Central Asia',\n        '2': 'Sub-Saharan Africa',\n        '3': 'The Americas',\n        '4': 'East Asia & Pacific',\n        '5': 'Middle East & North Africa'\n    }[datum.cluster]", "as": "region"}, {"filter": "datum.country !== 'North Korea' && datum.country !== 'South Korea'"}, {"filter": {"param": "x_select"}}]}, {"mark": {"type": "text", "align": "left", "dx": 5, "dy": -5, "fontSize": 14}, "encoding": {"color": {"value": "#222222"}, "detail": {"field": "country", "type": "nominal"}, "text": {"field": "year", "type": "ordinal"}, "x": {"field": "fertility", "scale": {"zero": false}, "title": "Babies per woman (total fertility rate)", "type": "quantitative"}, "y": {"field": "life_expect", "scale": {"zero": false}, "title": "Life expectancy", "type": "quantitative"}}, "transform": [{"calculate": "{\n        '0': 'South Asia',\n        '1': 'Europe & Central Asia',\n        '2': 'Sub-Saharan Africa',\n        '3': 'The Americas',\n        '4': 'East Asia & Pacific',\n        '5': 'Middle East & North Africa'\n    }[datum.cluster]", "as": "region"}, {"filter": "datum.country !== 'North Korea' && datum.country !== 'South Korea'"}, {"filter": {"param": "param_0cfcd5e47607a746", "empty": false}}]}, {"mark": {"type": "text", "align": "left", "dx": -15, "dy": -25, "fontSize": 18, "fontWeight": "bold"}, "encoding": {"color": {"value": "black"}, "opacity": {"condition": [{"param": "param_0cfcd5e47607a746", "value": 1, "empty": false}], "value": 0}, "text": {"field": "country", "type": "nominal"}, "x": {"field": "fertility", "type": "quantitative"}, "y": {"field": "life_expect", "type": "quantitative"}}, "transform": [{"window": [{"op": "rank", "field": "life_expect", "as": "rank"}], "groupby": ["country"], "sort": [{"field": "life_expect", "order": "descending"}]}, {"filter": "(datum.rank === 1)"}, {"aggregate": [{"op": "max", "field": "life_expect", "as": "life_expect"}, {"op": "max", "field": "fertility", "as": "fertility"}], "groupby": ["country"]}]}, {"layer": [{"mark": {"type": "trail"}, "encoding": {"color": {"value": "#222222"}, "detail": {"field": "country", "type": "nominal"}, "opacity": {"condition": [{"param": "param_0cfcd5e47607a746", "value": 0.3, "empty": false}], "value": 0}, "order": {"field": "year", "sort": "ascending", "type": "quantitative"}, "size": {"field": "year", "legend": null, "scale": {"domain": [1955, 2005], "range": [1, 12]}, "type": "quantitative"}, "x": {"field": "fertility", "scale": {"zero": false}, "title": "Babies per woman (total fertility rate)", "type": "quantitative"}, "y": {"field": "life_expect", "scale": {"zero": false}, "title": "Life expectancy", "type": "quantitative"}}, "transform": [{"calculate": "{\n        '0': 'South Asia',\n        '1': 'Europe & Central Asia',\n        '2': 'Sub-Saharan Africa',\n        '3': 'The Americas',\n        '4': 'East Asia & Pacific',\n        '5': 'Middle East & North Africa'\n    }[datum.cluster]", "as": "region"}, {"filter": "datum.country !== 'North Korea' && datum.country !== 'South Korea'"}]}, {"mark": {"type": "point", "size": 50}, "encoding": {"color": {"field": "region", "legend": {"labelFontSize": 12, "orient": "bottom-left", "titleFontSize": 14}, "scale": {"scheme": "dark2"}, "title": "Region", "type": "nominal"}, "detail": {"field": "country", "type": "nominal"}, "opacity": {"condition": [{"param": "param_0cfcd5e47607a746", "value": 0.8, "empty": false}], "value": 0}, "x": {"field": "fertility", "scale": {"zero": false}, "title": "Babies per woman (total fertility rate)", "type": "quantitative"}, "y": {"field": "life_expect", "scale": {"zero": false}, "title": "Life expectancy", "type": "quantitative"}}, "transform": [{"calculate": "{\n        '0': 'South Asia',\n        '1': 'Europe & Central Asia',\n        '2': 'Sub-Saharan Africa',\n        '3': 'The Americas',\n        '4': 'East Asia & Pacific',\n        '5': 'Middle East & North Africa'\n    }[datum.cluster]", "as": "region"}, {"filter": "datum.country !== 'North Korea' && datum.country !== 'South Korea'"}]}]}, {"mark": {"type": "text", "baseline": "middle", "fontSize": 96, "opacity": 0.2}, "encoding": {"text": {"field": "year", "type": "ordinal"}}, "transform": [{"filter": {"param": "x_select"}}, {"aggregate": [{"op": "max", "field": "year", "as": "year"}]}]}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v3.2.1/data/gapminder.json"}, "height": 500, "padding": 10, "params": [{"name": "param_0cfcd5e47607a746", "select": {"type": "point", "fields": ["country"], "on": "mouseover"}, "views": ["view_8564c15f60459f85_0"]}, {"name": "param_0f5c0e4c9fd46f03", "select": {"type": "point", "fields": ["country"], "on": "mouseover"}, "views": ["view_8564c15f60459f85_0"]}, {"name": "x_select", "select": {"type": "point", "fields": ["year"]}, "bind": {"input": "range", "max": 2005, "min": 1955, "name": "Year ", "step": 5}, "value": 1980, "views": ["view_8564c15f60459f85_0"]}, {"name": "param_82df1923d868131d", "bind": {"input": "search", "name": "Search ", "placeholder": "Country"}, "value": ""}], "width": 500, "$schema": "https://vega.github.io/schema/vega-lite/v6.1.0.json"};
    // vegaEmbed 会自动处理 spec 是 vega 还是 vega-lite
    vegaEmbed('#vis', spec, { "actions": false }).catch(console.error);
  </script>
</body>
</html>
